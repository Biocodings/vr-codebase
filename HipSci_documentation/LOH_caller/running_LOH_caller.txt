Using the LOH Caller
====================

This program was only developed to v0.1. It will probably be replaced by the CNV caller that Petr is working on at present 
(beginning of March 2014). We have discussed this and we agreed that it would be better for LOH calls to be made along 
with the other CNV predictions he will make, as it's cleaner to have it all from one program. The LOH caller 
described here is therefore expected to only be used in the short-term.

Also, please note that the predicted LOH regions are often refered to as custom CNVs within HipSci, although they are only 
LOH regions (this program was originally intended to be extended further to predict CNVs, but Petr is doing this now).

Regions of LOH are identified as consecutive SNPs where a het call in the control is not present in an iPS sample e.g.

SNP   Control   iPS #1  iPS #2
   
A     0/0       0/0     1/1
B     1/0       0/0     1/0
C     1/0       1/1     1/0
D     1/1       1/0     0/0

In this example there is a LOH region in iPS sample #1 which spans the 2nd and 3rd SNPs.

The LOH caller uses a VCF generated from the genotyping fcr file. This VCF is generated by VRPipe.

The LOH regions allow inclusion of small gaps. This is because often the CNVs identified during development were observed to be 
separated by small numbers of SNPs, and so were considered one LOH/CNV event. See the documents "HipSci custom CNVs benchmarking.xlsx" and 
"HipSci custom CNVs update.docx" in the benchmarking_docs directory for further information about method development concerning 
inclusion of gaps.

Obtain the VCF file from VRPipe
===============================

VCFs are now generated for all newly released genotyping data within VRPipe. You can also generate them yourself using a command 
such as:

cat <fcr.txt> | fcr-to-vcf -a /lustre/scratch107/projects/hipsci/genotyping/map.2014-02-10.tab.gz -o out

fcr-to-vcf is Petr's script - please refer to him for further information about this program.

[You may need to change the sample IDs to friendly IDs if you generate the VCFs yourself from the genotyping fcr 
obtained from iRODS.]

Assuming you now have a VCF which contains one HipSci cohort e.g. veve.vcf you can now...

Run the LOH Caller on the VCF
=============================

>perl hipsci_loh_caller.pl -v veve.vcf.gz -c veve -sb -l example.log

where:

-v = your cohort's VCF
-c = control sample's ID (not necessarily the same as the VCF file name)
-s = short/concise output i.e. limit the output (don't show any other output apart from bed)
-b = BED output
-l = any log file name

... so this should give you only BED output.

If you ran it using the following, you wouldn't get bed, you'd get a more descriptive output: 

>perl hipsci_loh_caller.pl -v veve.vcf.gz -c veve -l example.log

Typically the LOH region predictions look like the example shown below, where mismatch:1 indicates a difference between the control and iPS samples.

veve_2:
======
1 CNV containing 4 SNPs (window size = 7 flexibility = 70%)
CNV #1: Summary: 4SNPs Chr1:201560163-201571927
CNV #1: Chr:1 Coord:201560163 SNP:rs608356       Mismatch:1
              Coord:201561620 SNP:rs545372       Mismatch:0
              Coord:201564909 SNP:rs609391       Mismatch:1
              Coord:201571927 SNP:rs621662       Mismatch:1
