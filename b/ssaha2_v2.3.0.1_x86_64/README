
==========================
= SSAHA2 version 2.3.0.1 =
==========================

by Hannes Ponstingl, Adam Spargo and Zemin Ning.

Copyright (C) 2003-2008 The Wellcome Trust Sanger Institute, Cambridge, UK.
All Rights Reserved.

SSAHA2 is a package combining SSAHA with cross_match developed
by Phil Green at the University of Washington.

Reference: Ning Z, Cox AJ, Mullikin JC.
           SSAHA: a fast search method for large DNAdatabases.
           Genome Res. 2001 Oct;11(10):1725-9.

DESCRIPTION:

ssaha2Build  This program constructs the hashtable
             required by the other ssaha2 programs.
             This provides an index for the given subject
             sequence.

ssaha2       This program aligns query sequences against a
             subject hashtable.

ssahaSNP     ssahaSNP is a polymorphism detection tool.
             It detects homozygous SNPs and indels by aligning
             shotgun reads to the finished genome sequence.
             From the best alignment, SNP candidates are
             screened, taking into account the quality value
             of the bases with variation as well as the quality
             values in the neighbouring bases, using 
             neighbourhood quality standard (NQS).

USAGE:
   *************************************************************
   * NOTE: SSAHA2 & SSAHASNP COMMAND LINE FORMATS HAVE CHANGED *
   *       with version 1.0.9                                  *
   *************************************************************

      ssaha2Build [OPTIONS] -save <hash name> <subject file>

      ssaha2 [OPTIONS] -save <hash name> <query file> [<query file 2nd>]
      ssaha2 [OPTIONS] <subject file> <query file> [<query file 2nd>]

      ssahaSNP [OPTIONS] -save <hash name> <query file>
      ssahaSNP [OPTIONS] <subject file> <query file>

   where <subject file> and <query file> are fasta or fastq files with
   the reference (subject) and query sequence files. <hash name> is
   the root name of the hash table files created from the reference
   sequence using ssaha2Build.
   The paired-end module invoked with the -pair option (see below)
   expects two query files with file <query file> containing the first
   and <query file 2nd> containing the second mate of each pair. The
   mates of a paired-end read must occur at the same postion in the
   sequence of reads in <query file> and <query file 2nd>. The paired-
   end module is not available for ssahaSNP.

OPTIONS:

 -h, -help     Print this page.
 -v, -version  Print version information.
 -c, -cookbook Print some example parameter sets, suitable
               for common tasks.

All other options, except the '-solexa' and '-454' flags and the
'-output ssaha2 cigar' option, are key-value pairs. Options are described below
(default values in brackets):

 -save <FILENAME>
            ssaha2Build: Root name of the files to which the
                         hash table is saved. The set of files
                         have the extensions FILENAME.head FILENAME.body
                         FILENAME.name FILENAME.base FILENAME.size
            ssaha2, ssahaSNP: Read hash table from files created by ssaha2Build.
	                   If -save is not specified then the first file name
                         specifies the reference sequence for which a hash
                         table is constructed on the fly

 -kmer      Word size for ssaha hashing (12).

 -skip      Step size for ssaha hashing (12).

 -ckmer     Word size for cross_match matching (10).

 -cmatch    Minimum match length for cross_match matching (14).

 -cut       Number of repeats allowed before this kmer is ignored (10000).

 -seeds     Number of kmer matches required to flag a hit (5).

 -depth     Number of hits to consider for alignment (50).

 -memory:   Memory assigned in MBs for the alignment matrix (200).

 -score     Minimum score for match to be reported (30).

 -identity  Minimum identity for match to be reported (50.000000).

 -port      Port number for server (60000).

 -align     If set to > 0, output graphical alignment (0).
            If set to 2 and -solexa flag is set: output also quality score.

 -edge      (obsolete as of release 2.0.0) Augment hit by this many bases
            before alignment (200).

 -array:    Memory assigned in bytes for frequency arrays (4000000).

 -start:    first sequence to process in query (0).

 -end:      last sequence to process in query, 0 means process all (0).

 -sense     (obsolete as of release 2.0.0) Allow really patchy hits to go
            for alignment (0).

 -best      If set to 1, only report the best alignment for each
            match, if multiple best scores report all (0).

 -454:      (see -rtype) Tune for 454 reads (0). Implies '-skip 3 -seeds 2
            -score 30 -sense 1 -cmatch 10 -ckmer 6'

 -NQS:      Use NQS to filter SNPs if set to 1, otherwise output all
            candidates (1).

 -quality:  Quality value to use for variation base in NQS (23).

 -tags:     If set to 1, prefix added to output summary lines to
            aid parsing, the prefix depends upon the chosen
            output format, e.g. if output is ssaha2 then the
            prefix is ALIGNMENT (1).

 -output:   ssaha2       - original ssaha2 line only (default)
            sugar        - Simple UnGapped Alignment Report
            cigar        - Compact Idiosyncratic Gapped Alignment Report
            vulgar       - Verbose Useful Labelled Gapped Alignment Report
            psl          - Tab separated format similar to BLT
                         http://genome.ucsc.edu/goldenPath/help/customTrack.html
            pslx         - Tab separated format with sequence
            gff          - http://www.sanger.ac.uk/Software/formats/GFF/
            ssaha2 cigar - alternate between ssaha2 and cigar format lines
            aln          - Tony Cox' alingnment output format.

            for a full description of output formats see:
                 http://www.sanger.ac.uk/Software/analysis/SSAHA2/formats.shtml

 -name      Flag that modifies option '-output cigar' such that read name
            and length are also reported when there was no hit found.

 -diff:     Output all hits within diff of the best (-1).

 -udiff:    Ignore best hit if second best score within udiff (0).

 -fix:      If set to 1, fix -edge, -seeds, -score so that they
            are not updated according to read length in ssahaSNP (0).

 -disk:     0: map all files into memory including the query sequences. (0)
            1: read hashtable body, the subject and query sequences from disk
               rather than loading them into memory.
            2: like 1 but the subject sequences are read into memory. The body
               is left on the disk.
            In both cases the query sequence file is not mapped into memory.
 -weight:   If >0, apply this much weighting to rare kmers (0).

 -solexa:   (see -rtype) implies (ssaha2 and ssahaSNP only):
            -kmer 13 -skip 2 -seeds 2 -score 12 -cmatch 9 -ckmer 6.
            Top scoring hits with lower quality at the mismatch positions
            have their Smith-Waterman score incremented by 1. Mapping
            scores are changed accordingly. SsahaSNP reports in such cases
            only the top scoring hit (no Repeat lines).

 -rtype:    solexa          - like -solexa flag
            454             - like -454 flag
            abi             - tunes for ABI reads (default)

 -pair <dist_lower>,<dist_upper>: Map paired-end reads with an insert length in
            the interval [<dist_lower>,<dist_upper>]. The reads for each mate
            are in a separate input file named by the last two tokens of the
            command line. The sequence for both mates are read in the same
            direction. Paired-end reads are reported if the mates match within
            <dist_upper> bases from each other, but at least <dist_lower> bases
            apart. No mate is reported, if the mapping is ambiguous, i.e. if
            there are multipe hits with the same Smith-Waterman alignment score
            in the specified distance range.
            If hits are found only for one mate, the highest scoring hit is
            reported for this mate unless it is ambiguous.

 -outfile <file_name> Output file for mate pairs that map outside the specified
            distance range unambiguously (each with a mapping score > 30, or a
            value set with the -mthresh option below). This option requires the
            -pair option to be set.

 -mthresh <mapping_score>  Threshold in the mapping score for mate pairs to be
            reported that map outside the distance range (see option -outfile).
            <mapping_score> is an integer between 0 and 50 (default: 30).
            This option requires the -pair option to be set.


============
Main changes since version 1.0.4
============

- IMPORTANT COMMAND LINE FORMAT CHANGE: ssaha2 and ssahaSNP now read hash table
  files generated by ssaha2Build with the -save option.
  If the -save option is omitted, the first token after the options specifies the
  reference (subject) sequence file in FASTQ/FASTA format.

- Added '-solexa' and '-454' flags to command line options. The flags
  set default parameters for query reads obtained with Solexa or,
  respectively, 454 sequencing technology. The defaults can be
  overwritten, e.g. '-solexa -score 14'.
  Alternatively, the read type can be specifed with the '-rtype' option.

  When the '-solexa' flag is set (-rtype solexa), top hits with lower quality
  at the mismatch positions have their Smith Waterman score incremented by 1
  unit. Mapping scores are changed accordingly. ssahaSNP reports in
  such cases only the top scoring hit.

- Changed '-output cigar' and '-tags 1' output to include a heuristic mapping
  score for multiple hits. This score indicates how much the top
  scoring (by Smith-Waterman) hit stands out from the second highest
  score. The score map_score =(max_score - 2nd_score)*300/query_length
  for a query sequence of length query_length is reported in the range
  [0,50], i.e. reported_score = map_score*H(50-map_score) where
  H is the Heaviside step function.

- ssahaSNP output has changed and now reports  mutliple hits with the same score.
  For each such hit an additional line is added starting with the keyword
  'Repeat' followed by the maximum Smith-Waterman score and the read_name.

- ssaha2 now comprises a paired-end read module which is invoked with
  the command line option -pair <lower_bound>,<upper_bound> specifying
  an insert size range. Mate pairs mapping outside the specified range
  are written to a separate file with the option -outfil <file_name>.


==========
Change Log
==========

Release 2.3.0.1  (3 April 2009)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- fixed a bug in version 2.3 that occurred for paired-end
  reads. Quality values following a quality value of 0 in the read
  were undefined.

(2.3.1.0.1: 3 April 2009, ssaha2 hp3)

Release 2.3  (6 March 2009)
~~~~~~~~~~~~~~~~~~~~~~~~~~~

- Added '-mthresh <MSCORE>' option by which a threshold in the mapping
  score can be set above which mate pairs are reported that map outside
  the insert size range. 0<= MSCORE <= 50. The default is -mthresh 30.

- fixed a bug introduced in 2.2 that caused the assignment
  of wrong mapping scores for mate pairs.

(2.3: 6 March 2009, ssaha2 hp3)

Release 2.2.1 (16 February 2009)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- fixed bug introduced in version 2.2 where reads with > 5000 bases
  matched over the entire length in which case execution stopped with
  the message "position_table - Query probably contains unusual
  characters".

(2.2.1: 16 February 2009, ssaha2 hp3)

Release 2.2 (29 January 2009)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- added '-disk 2' option where hash table body and the query sequences
  are left on disk and the hashtable header and the reference
  sequences are kept in memory.

- The '-disk 0' option now keeps the reference sequences in memory.

- The paired-end read module (invoked with '-pair a,b') now
  requires separate input files for the reads of the two mates.
  The direction of the sequences are the same for both mates. 

- added Tony Cox' output format '-output aln'.

- minor fixes that improved the accuracy of ssaha2.

- Fix of a bug (introduced in version 2.0.0) that had ssaha2 stopping
  execution with the message "position_table - Query probably contains
  unusual characters" on some longer (>5000 bases) query reads.

(2.2: 29 January 2009, ssaha2 hp3)


Release 2.1 (18 September 2008)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- implemented paired-end read module with option '-pair a,b' specifying an
  insert range and '-outfil' specifying an output file for pairs mapping
  outside this range.

- '-solexa' and '-rtype solexa' flags now imply
  '-kmer 13 -skip 2 -seeds 2 -score 12 -cmatch 9 -ckmer 6'
  These defaults can be overwritten, i.e. '-rtype solexa -kmer 12'.

- reduced memory usage for query files with a large
  number of short reads.

- Occasionally the first few bases are missed in the Smith-Waterman alignment if
  these bases contain mismatches. This version restores the full alignment if the
  -solexa (-rtype solexa) flag is set and the Smith-Waterman alignment starts (ends)
  at the 3rd or 4th (to last) base.

- Fixed a bug in the PSL and PSLX output formats (wrong block starts).

(2.1: 18 September 2008, ssaha2 hp3)

Release 2.0.0 (16 May 2008)
~~~~~~~~~~~~~~~~~~~~~~~~~~~

- improved speed for shorter reads (-solexa and -454 flags):

  Changes were made to the filtering of potentially matching segments
  before they are passed to the Smith-Waterman alignment. Potetial
  matches are filtered out if the number of matching k-mer words
  (seeds) falls below MAXSEEDS - 5 where MAXSEEDS is the maximum in
  the number of seeds observed so far for the query sequence.

  ABI reads (default) are processed as before.

- -edge option is now obsolete. Matching segments are now extended to the
  query read length plus 10 bases on either side.

- -solexa flag now implies -cmatch 9 (previously -cmatch 10), i.e. overall
  '-seeds 2 -score 12 -cmatch 9 -ckmer 6'.

(2.0.0: 16 May 2008, ssaha2 hp3)


Release 1.1.1 alpha (11 May 2008)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- increased speed for processing of shorter reads.

- Deactivated -sense flag.

- introduced -454 flag which tunes for 454 reads. The flag implies
  '-skip 3 -seeds 2 -score 30 -cmatch 10 -ckmer 6' which
  can be overwritten. The default minimum edge length is set to 100. It can
  be increased with the -edge option.

- introduced option '-rtype [abi|454|solexa]' option as an alternative
  to -solexa and -454 flags. I.e. '-rtype solexa' is equivalent to
  '-solexa' '-rtype 454' equivalent to '-454'. Should there be more
  than one of these mutually exclusive options specified on the
  command line, the last overwrites all others.
 

(1.1.1: 11 May 2008, ssaha2 hp3)


Release 1.1.0 alpha (3 April 2008)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- substantial speed improvements for processing of short reads

- introduced a minimum depth of 500
  i.e. the depth specified with option '-depth <DEPTH>' will
  be disregarded unless DEPTH > 500.

- the default minimum edge length for the -solexa flag is set to 30. It
  can be increased with the -edge option.
  

(1.1.0: 3 April 2008, ssaha2 hp3)


Release 1.0.9 (20 February 2008)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- Added '-name' flag which modifies option '-output cigar' in 
  that read name and length are reported even when there was
  no hit found. So far reads with no hits were skipped over.

- Added the option '-save <table name>' to ssaha2 and ssahaSNP.  If
  this option is specified a hash table saved by 'ssaha2Build -save
  <table name>' will be read from disk. The first token after the
  options now specifies the fastq/fasta query sequence file. 
  If the '-save' option is not specified , the first token after the
  option flags specifies the subject sequence file for which a
  hash table is constructed 'on the fly'.

- ssaha2Build now appends the skip step size (-skip) and k-mer lenth (-kmer)
  to the *.size file of the hash table files.
  ssaha2 tries to read those values. If it can find them default values or
  values specified on the command line are overwritten.

- Added the option '-output ssaha2 cigar' which outputs ssaha2 format
  lines interleaved with cigar format lines.

- Fixed a bug that severely slowed down processing of large query files
  with a high number of short reads.

- The flag '-solexa' implies now default '-skip 1' which can be overwritten.
  I.e. '-solexa -skip 2'.
  
(1.0.9: 20 February 2008, ssaha2 hp3)


Release 1.0.8 (18 January 2008)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- Fixed a problem with short reads < 20 bases in length. Only one alignment
  was reported in such cases. Now reads kan be as small as k-mer length (specified
  with option -kmer) + 2 bases.

- When the '-solexa' flag is set, the alignment score is no longer complexity
  weighted, but returned as the raw Smith-Waterman score.

(1.0.8: 18 January 2008, ssaha2 hp3)


Release 1.0.7 (11 January 2008)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- Fixed output of heuristic mapping score to fill 2 digits also when <
  10. E.g. a mapping score of 9 is output as 'CIGAR::09 ...'.
  
- Included output of heuristic mapping score with the option '-tags 1'.
  I.e. a tagged line starts with 'ALIGNMENT::09' analoguous to CIGAR
  output.

- Ssaha2 has now -tags 1 as default setting.

- Flag '-solexa' sets now also the following option defaults
  '-seeds 2 -score 12 -sense 1 -cmatch 10 -ckmer 6'.  The defaults
  can be overwritten, e.g. '-solexa -score 14'.

- Improved speed of reading query sequence files. Previously, the
  query file was read twice. Once to determine the size of the data
  which was than read into memory in a second pass. Reduced this to 
  1 pass in ssaha2.
  
(1.0.7: 11 January 2008, ssaha2 hp3)


Release 1.0.6 beta (3 December 2007)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- Changed 'ssaha2 -output cigar' output to include a heuristic mapping
  score (0 <= map_score <= 50) for multiple hits. This score indicates
  how much the top scoring (by Smith-Waterman) hit stands out from the
  second highest score.

- Changed the ssahaSNP output to report mutliple hits with the same score.
  For each such hit an additional line is added starting with the keyword
  'Repeat' followed by the maximum Smith-Waterman score and the read_name.

- When the '-solexa' flag is set, top hits with lower quality at the
  mismatch positions have their Smith Waterman score incremented by 1
  unit. Mapping scores are changed accordingly. ssahaSNP reports in
  such cases only the top scoring hit (no Repeat lines).

(1.0.6: 28 November 2007, ssaha2 hp3)


Release 1.0.5 (23 November 2007)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

New command line options for the use of quality factors in the scoring of
aligned hits. Basic documentation of the source code in Doxygen style
was also added.

- New command line option '-solexa': Solexa reads are given in FASTQ
  format with quality scores. Sort the output of aligned hits with
  identical Smith-Waterman scores according to the average of quality
  scores over the mismatch positions in ascending order.

- New comand line option '-align 2': Output of alignments as with
  '-align 1' but with quality scores added in decimal format (scores
  in the range 1-99 are written vertically in columns 1 character wide
  and 2 characters high).

(1.0.5: 23 November 2007, ssaha2 hp3)
